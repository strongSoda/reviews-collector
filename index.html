<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collect Reviews</title>

    <!-- <script src="https://cdn.tailwindcss.com"></script> -->
    <!-- css -->

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <div class="container px-5 py-24 mx-auto flex">
        <div class="left">
            <div class="website_details">
                <img id="website_logo" src="" alt="">
                <a href="" id="website_url" target="_blank"><h2 id="website_name"></h2></a>
                <p id="website_desc" class="leading-relaxed mb-5 text-white-600"></p>
            </div>
            <div class="product_details">
                <img id="product_image" src="" alt="">
                <a href="" id="product_url" target="_blank"><h2 id="product_name"></h2></a>
                <p id="product_desc" class="leading-relaxed mb-5 text-white-600"></p>
                <!-- <h3 id="product_desc"></h3> -->
                <!-- <p id="product_url"></p> -->
            </div>
        </div>
        <div class="right">
            <!-- <h3 class="title">Submit Your Review</h3> -->
            <!-- reviews collection form -->
            <form>
                <!-- star rating -->
                <label class="rating-label">
                    <strong>Rating: <span class="ratingNumber">1</span></strong>
                    <input class="rating" max="5" oninput="this.style.setProperty('--value', this.value); console.log(this.value); showRatingNumber(this.value)" step="0.5" type="range" value="1">
                </label>
                <br />
                <label for="name">Name:</label>
                <input type="text" name="name" id="name" placeholder="Enter your Name">
                <br />
                <label for="review" class="leading-7 text-sm text-gray-600">Review</label>
                <textarea id="review" name="review" placeholder="Type your review..."
                    class="w-full bg-white rounded border border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 h-32 text-base outline-none text-gray-700 py-1 px-3 resize-none leading-6 transition-colors duration-200 ease-in-out"></textarea>
                <br />
                <label for="city">City:</label>
                <input type="text" name="city" id="city" placeholder="New York">
                <br />
                <!-- email -->
                <label for="email" class="leading-7 text-sm text-gray-600">Email</label>
                <input type="email" id="email" name="email" placeholder="Enter your email"
                    class="w-full bg-white rounded border border-gray-300 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 text-base outline-none text-gray-700 py-1 px-3 leading-8 transition-colors duration-200 ease-in-out">
                <br />
                <label for="profile_pic">Porfile Image:</label>
                <input type="file" name="profile_pic" id="profile_pic">

                <br />
                <input type="submit" value="Submit">
            </form>
        </div>
    </div>
    <footer>Powered by Ureka.io</footer>
    <script>
        // show rating number
        function showRatingNumber(value) {
            document.querySelector('.ratingNumber').innerHTML = value;
        }

        // parse query string
        function getQueryVariable(variable) {
            var query = window.location.search.substring(1);
            var vars = query.split("&");
            for (var i=0;i<vars.length;i++) {
                var pair = vars[i].split("=");
                if(pair[0] == variable){return pair[1];}
            }
            return(false);
        }

        // get query string value
        console.log(decodeURI(getQueryVariable('website_name')));
        console.log(decodeURI(getQueryVariable('website_url')));
        console.log(decodeURI(getQueryVariable('website_desc')));
        console.log(decodeURI(getQueryVariable('website_logo')));
        console.log(decodeURI(getQueryVariable('website_logo')));
        console.log(decodeURI(getQueryVariable('website_logo')));
        console.log(decodeURI(getQueryVariable('product_name')));
        console.log(decodeURI(getQueryVariable('product_desc')));
        console.log(decodeURI(getQueryVariable('product_image')));
        console.log(decodeURI(getQueryVariable('product_url')));

        // set website name
        document.querySelector('#website_name').innerHTML = decodeURI(getQueryVariable('website_name'));
        // set website url
        document.querySelector('#website_url').href = decodeURI(getQueryVariable('website_url'));
        // set website desc
        document.querySelector('#website_desc').innerHTML = decodeURI(getQueryVariable('website_desc'));
        // set website logo
        document.querySelector('#website_logo').src = decodeURI(getQueryVariable('website_logo'));
        // set product name
        document.querySelector('#product_name').innerHTML = decodeURI(getQueryVariable('product_name'));
        // set product desc
        document.querySelector('#product_desc').innerHTML = decodeURI(getQueryVariable('product_desc'));
        // set product image
        document.querySelector('#product_image').src = decodeURI(getQueryVariable('product_image'));
        // set product url
        document.querySelector('#product_url').href = decodeURI(getQueryVariable('product_url'));

        console.log(decodeURI(getQueryVariable('submission')));
        // get form data
        var form = document.querySelector('form');
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            var formData = new FormData(form);
            // var xhr = new XMLHttpRequest();
            // xhr.open('POST', 'https://ureka.io/api/v1/reviews');
            // xhr.send(formData);
            // xhr.onload = function() {
            //     console.log(xhr.responseText);
            // };

            let url = 'https://api.sheety.co/e6308a30988c2a9e6e0ead2fd194efa5/urekaReviewsCollections/db';
            let body = {
                db: {
                    websiteName: decodeURI(getQueryVariable('website_name')),
                    websiteUrl: decodeURI(getQueryVariable('website_url')),
                    websiteDesc: decodeURI(getQueryVariable('website_desc')),
                    websiteLogo: decodeURI(getQueryVariable('website_logo')),
                    productName: decodeURI(getQueryVariable('product_name')),
                    productDesc: decodeURI(getQueryVariable('product_desc')),
                    productImage: decodeURI(getQueryVariable('product_image')),
                    productUrl: decodeURI(getQueryVariable('product_url')),
                    submissionEmail: decodeURI(getQueryVariable('submission')),
                    reviewerName: form.name.value,
                    reviewText: form.review.value,
                    reviewerCity: form.city.value,
                    reviewerEmail: form.email.value,
                    reviewerProfileImage: form.profile_pic.value,
                    // select ratingNumber
                    rating: document.querySelector('.ratingNumber').innerHTML,
                    date: new Date().toISOString(),
                }
            }
            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(body)
            })
                .then((response) => response.json())
                .then(json => {
                    // Do something with object
                    console.log(json.db);
                });
        });

        // Ureka.io is the best reviews no-code solution.
        // http://127.0.0.1:5500/index.html?website_name=Ureka&website_url=https://ureka.io&submission=ikhan77727@gmail.com&website_desc=Win%20new%20customers%20with%20reviews%20on%20your%20website&website_logo=https://ureka.io/assets/images/favicon.png?v=b289904a&product_name=Reviews%20Wall&product_desc=Integrate%20reviews%20seamlessly%20into%20your%20website&product_image=https://ureka.io/assets/images/image11.jpg?v=b289904a&product_url=https://ureka.io/#wall-widget-demo
    </script>
    
</body>
</html>
